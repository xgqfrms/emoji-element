<!-- demos -->
<wcui-button></wcui-button>
<wcui-button type="primary">
  <span slot="text">
    é»˜è®¤æŒ‰é’®
  </span>
</wcui-button>
<wcui-button type="success" callback="callback">
  <span slot="text">
    æˆåŠŸæŒ‰é’®
  </span>
</wcui-button>
<wcui-button type="warning">
  <span slot="text" callback="callback">
    è­¦å‘ŠæŒ‰é’®
  </span>
</wcui-button>
<wcui-button type="danger">
  <span slot="text">
    å±é™©æŒ‰é’®
  </span>
</wcui-button>

<!-- æ¨¡ç‰ˆ -->
<template id="wcui-button-template">
  <style>
    .wcui-button {
      display: inline-block;
      padding: 4px 20px;
      font-size: 14px;
      line-height: 1.5715;
      font-weight: 400;
      border: 1px solid #1890ff;
      border-radius: 2px;
      background-color: #1890ff;
      color: #fff;
      box-shadow: 0 2px #00000004;
    }
    .wcui-button-success {
      border: 1px solid #14fa4a;
      background-color: #14fa4a;
    }
    .wcui-button-warning {
      border: 1px solid #faad14;
      background-color: #faad14;
    }
    .wcui-button-danger {
      border: 1px solid #ff4d4f;
      background-color: #ff4d4f;
    }
  </style>
  <div id="wcui-button">
    <slot name="text">é»˜è®¤æŒ‰é’®</slot>
  </div>
</template>

<script>
  // 1. è·å– DOM æ¨¡ç‰ˆ
  // const template = document.getElementById("wcui-button-template");
  const template = document.querySelector(`#wcui-button-template`);
  console.log('\ntemplate =', template);
  // 2. ç»§æ‰¿ HTMLElement ç±»
  class wcuiButton extends HTMLElement {
    constructor() {
      super();
      // type å±æ€§
      this.types = {
        primary: 'wcui-button',
        success: 'wcui-button-success',
        warning: 'wcui-button-warning',
        danger: 'wcui-button-danger',
      };
      this.defaultType = 'wcui-button';
      // å¼€å¯ Shadow DOM
      const shadow = this.attachShadow({
        mode: 'open',
      });
      // å…‹éš†ä¸€ä»½, é˜²æ­¢é‡å¤ä½¿ç”¨é€ æˆæ±¡æŸ“
      const content = template.content.cloneNode(true);
      console.log('\content =', content);
      // æŠŠå“åº”å¼æ•°æ®æŒ‚åˆ°this
      const type = this;
      console.log('\ntype =', type);
      console.log('this.types[type] =', this.types[type]);
      // è·å– template DOM
      this.btn = content.querySelector('#wcui-button');
      console.log('this.btn =', this.btn);
      if(this.types[type]) {
        // this.btn.classList.add(this.types[type]);
        this.btn.className += this.types[type];
      } else {
        this.btn.classList.add(this.defaultType);
        // this.btn.classList.add('bug-style');
      }
      console.log('this.btn.className =', this.btn.className);
      shadow.appendChild(content);
    }
    // observedAttributes
    /*
    static get observedAttributes() {
      return ['type']
    }
    */
    // ç”Ÿå‘½å‘¨æœŸæ–¹æ³•

    // connectedCallback
    // å½“ custom element é¦–æ¬¡è¢«æ’å…¥æ–‡æ¡£DOMæ—¶ï¼Œè¢«è°ƒç”¨ã€‚

    // disconnectedCallback
    // å½“ custom element ä»æ–‡æ¡£DOMä¸­åˆ é™¤æ—¶ï¼Œè¢«è°ƒç”¨ã€‚

    // adoptedCallback
    // å½“ custom element è¢«ç§»åŠ¨åˆ°æ–°çš„æ–‡æ¡£æ—¶ï¼Œè¢«è°ƒç”¨ã€‚

    // attributeChangedCallback
    // å½“ custom element å¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹`è‡ªèº«å±æ€§`æ—¶ï¼Œè¢«è°ƒç”¨ã€‚
    attributeChangedCallback(name, oldValue, newValue) {
      console.log('ğŸ‘» prop =', name);
      console.log('oldValue, newValue =', oldValue, newValue);
      this[name] = newValue;
      // update style
      this.render();
      // this.reRender();
    }
    // âœ… å¿…é¡»æŒ‡å®šè¦è§‚å¯Ÿå€¼ä¼šå˜åŒ–çš„ props, ä¸ç„¶ attributeChangedCallback ä¸ä¼šæ‰§è¡Œ
    static get observedAttributes() {
      return ['type']
    }
    /*
    attributeChangedCallback(prop, oldValue, newValue) {
      console.log('ğŸ‘» prop =', prop);
      console.log('oldValue, newValue =', oldValue, newValue);
      this[prop] = newValue;
      // update style
      this.render();
      // this.reRender();
    }
    */

    // æ¸²æŸ“
    render() {
      console.log('this.type =', this.type);
      this.btn.className = `wcui-button ${this.types[this.type]}`
    }
    reRender() {
      console.log('this.type =', this.type);
      this.btn.className = `wcui-button ${this.types[this.type]}`
    }
  }
  // âœ…  æ³¨å†Œè‡ªå®šä¹‰ç»„ä»¶ï¼ˆAutonomous custom elements / è‡ªä¸»è‡ªå®šä¹‰å…ƒç´ ï¼‰
  window.customElements.define('wcui-button', wcuiButton)
  // document.createElement("wcui-button")

  // âœ… æ³¨å†Œè‡ªå®šä¹‰ç»„ä»¶ï¼ˆCustomized built-in elements / å®šåˆ¶çš„å†…ç½®å…ƒç´ ï¼‰
  // window.customElements.define('wcui-button', wcuiButton, { extends: 'div' })
  // document.createElement("div", { is: "wcui-button" })
</script>
